<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Feedo - Login & Register</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif; }
    body { background:#4c4c4c; color:#222; display:flex; align-items:center; justify-content:center; min-height:100vh; flex-direction:column; }
    .container { background:#595858; padding:30px; border-radius:15px; width:320px; box-shadow:0 0 20px rgba(0,0,0,0.2); }
    h2 { text-align:center; color:#222; margin-bottom:20px; }
    input { width:100%; padding:10px; margin:10px 0; border:1px solid #ccc; border-radius:8px; background:#f2f0f0; color:#222; }
    button { width:100%; padding:10px; border:none; background:#a6a5a5; color:#000; font-weight:600; border-radius:8px; cursor:pointer; box-shadow:0 0 10px rgba(0,0,0,0.1); }
    button:hover { background:#7d7a7a; }
    p { text-align:center; margin-top:10px; color:#fffbfb; }
    a { color:#ffffff; cursor:pointer; font-weight:500; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <div class="container">
    <!-- LOGIN FORM -->
    <div id="loginSection">
      <h2>Login</h2>
      <form id="loginForm">
        <input type="text" id="loginPhone" placeholder="Phone Number" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button type="submit">Login</button>
      </form>
      <p><a onclick="showForgot()">Forgot Password?</a></p>
      <p>Donâ€™t have an account? <a onclick="toggleForms()">Register here</a></p>
    </div>

    <!-- REGISTER FORM -->
    <div id="registerSection" class="hidden">
      <h2>Register</h2>
      <form id="registerForm">
        <input type="text" id="registerName" placeholder="Full Name" required>
        <input type="text" id="registerPhone" placeholder="Phone Number" required>
        <input type="password" id="registerPassword" placeholder="Password" required>
        <button type="submit">Register</button>
      </form>
      <p>Already have an account? <a onclick="toggleForms()">Login here</a></p>
    </div>

    <!-- FORGOT PASSWORD FORM -->
    <div id="forgotSection" class="hidden">
      <h2>Forgot Password</h2>
      <form id="forgotForm">
        <input type="text" id="forgotName" placeholder="Your Name" required>
        <input type="text" id="forgotMobile" placeholder="Your Mobile Number" required>
        <button type="button" onclick="sendWhatsApp()">Send WhatsApp Request</button>
      </form>
      <p><a onclick="backToLogin()">Back to Login</a></p>
    </div>
  </div>

  <script>
    const BACKEND_URL = "https://app-59ed3zxcg-feedo397-gs-projects.vercel.app"; // deployed backend

    // Toggle forms
    function toggleForms() {
      document.getElementById("loginSection").classList.toggle("hidden");
      document.getElementById("registerSection").classList.toggle("hidden");
      document.getElementById("forgotSection").classList.add("hidden");
    }
    function showForgot() {
      document.getElementById("loginSection").classList.add("hidden");
      document.getElementById("registerSection").classList.add("hidden");
      document.getElementById("forgotSection").classList.remove("hidden");
    }
    function backToLogin() {
      document.getElementById("loginSection").classList.remove("hidden");
      document.getElementById("registerSection").classList.add("hidden");
      document.getElementById("forgotSection").classList.add("hidden");
    }

    function sendWhatsApp() {
      const name = document.getElementById("forgotName").value.trim();
      const mobile = document.getElementById("forgotMobile").value.trim();
      if(!name || !mobile){ alert("Please enter name and mobile number"); return; }
      const msg = `Hello, I forgot my password for Feedo app. My name is ${name} and my mobile number is ${mobile}.`;
      const url = `https://wa.me/8088975913?text=${encodeURIComponent(msg)}`;
      window.open(url, "_blank");
    }

    // LOGIN
    document.getElementById("loginForm").addEventListener("submit", async e => {
      e.preventDefault();
      const phone = loginPhone.value.trim();
      const password = loginPassword.value.trim();

      // Special admin/test login
      if(phone === "1231231230" && password === "112233") {
        // Check if upload.html exists before redirecting
        fetch("upload.html")
          .then(res => {
            if(res.ok){
              window.location.href = "upload.html";
            } else {
              alert("Upload page missing! Cannot redirect.");
            }
          })
          .catch(() => alert("Upload page missing! Cannot redirect."));
        return;
      }

      // Normal login flow
      try {
        const res = await fetch(`${BACKEND_URL}/login`, {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({ phone, password })
        });
        const data = await res.json();
        if(data.success){
          localStorage.setItem("loggedIn","true");
          localStorage.setItem("userName",data.user.name);
          localStorage.setItem("userPhone",data.user.phone);
          localStorage.setItem("userId",data.user._id);
          alert("Login successful!");
          window.location.href="index.html";
        } else { alert(data.message || "Invalid credentials"); }
      } catch(err){ console.error(err); alert("Login failed!"); }
    });

    // REGISTER
    document.getElementById("registerForm").addEventListener("submit", async e => {
      e.preventDefault();
      const name = registerName.value.trim();
      const phone = registerPhone.value.trim();
      const password = registerPassword.value.trim();
      try {
        const res = await fetch(`${BACKEND_URL}/register`, {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({ name, phone, password })
        });
        const data = await res.json();
        if(data.success){
          localStorage.setItem("loggedIn","true");
          localStorage.setItem("userName",data.user.name);
          localStorage.setItem("userPhone",data.user.phone);
          localStorage.setItem("userId",data.user._id);
          alert("Registered successfully!");
          window.location.href="index.html";
        } else { alert(data.message || "Registration failed"); }
      } catch(err){ console.error(err); alert("Registration failed!"); }
    });
  </script>
</body>
</html>
